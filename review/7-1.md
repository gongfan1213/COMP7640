# COMP7640 数据存储与访问方法课件详解

这份课件系统地介绍了数据库管理系统(DBMS)中的数据存储和访问方法。我将从存储层次结构、磁盘特性、文件组织和索引结构等方面为您详细解析。

## 一、存储层次结构

课件首先介绍了计算机系统的存储层次结构(Storage Hierarchy)：

1. **主存储器(RAM)**：用于存储当前使用的数据，访问速度快(约10ns)但价格昂贵且易失性。
   - 示例：500港币可购买16GB RAM或2TB硬盘
   - 不适合存储全部数据库数据，因为：数据量大、成本高、易失性

2. **磁盘(二级存储)**：主要的数据库存储介质，非易失性且成本低。
   - 访问速度比RAM慢约10^5倍(约10ms)

3. **磁带(三级存储)**：用于归档旧版本或不常访问的数据，访问速度最慢但成本最低。

## 二、磁盘结构与访问特性

### 磁盘物理结构
- **盘片(Platter)**：磁盘由多个盘片组成
- **磁道(Track)**：每个盘片上的同心圆
- **扇区(Sector)**：磁道被划分为固定大小的扇区(通常512字节)
- **块(Block)**：文件系统分配空间的最小单位(通常4KB)，包含多个扇区
- **柱面(Cylinder)**：所有盘片上相同位置的磁道集合

### 磁盘访问时间组成
访问磁盘块的时间由三部分组成：
1. **寻道时间(Seek Time)**：移动磁头到目标磁道(1-20ms)
2. **旋转延迟(Rotational Delay)**：等待目标扇区旋转到磁头下(0-10ms)
3. **传输时间(Transfer Time)**：实际数据传输时间(约1ms/4KB)

### 数据布局策略
课件通过两个策略对比说明了数据布局的重要性：

1. **随机存储策略**：
   - 记录分散在不同磁道和盘片
   - 访问每个记录都需要完整寻道和旋转
   - 示例：8000条记录访问时间=8000×26.7ms=213.6秒

2. **相邻存储策略**：
   - 记录存储在相邻柱面上
   - 后续访问只需短距离寻道(相邻磁道)
   - 示例：同样数据访问时间仅需1.746秒

结论：**将频繁一起访问的页面在磁盘上顺序排列可以显著减少I/O开销**。

## 三、数据表示与记录组织

### 基本数据表示
课件展示了如何在字节层面表示各种数据类型：
- 整数：2字节(如short)
- 浮点数：使用指数和分数部分
- 字符：ASCII编码(如'A'=01000001)
- 布尔：1字节(TRUE=11111111，FALSE=00000000)
- 日期时间：多种表示方法(整数或字符格式)
- 字符串：三种表示方法(空终止、长度前缀、固定长度)

### 记录结构
记录是相关数据项(字段)的集合。课件介绍了两种记录组织方式：

1. **定长记录**：
   - 所有字段长度固定
   - 字段连续存储
   - 字段地址可通过基地址+偏移量计算
   - 示例：MovieStar记录=30(name)+255(address)+1(gender)+10(birthday)=296字节

2. **变长记录**：
   - 通常在开头存储长度信息
   - 需要额外信息解释字段类型

### 页面格式
页面是磁盘与内存间传输的基本单位(通常4KB或8KB)，包含多个记录槽(slot)。课件展示了两种页面组织方式：

1. **紧凑式(Packed)**：记录连续存储，无空闲空间
2. **非紧凑式(Unpacked)**：使用位图标记空闲槽

记录通过记录ID(rid)标识，可以是逻辑ID(页号+槽号)或物理ID(设备+柱面+磁道+块+偏移量)。

## 四、文件组织方法

课件比较了三种主要的文件组织方式：

### 1. 堆文件(Heap File)
- 记录以任意顺序存储
- 优点：插入快速(只需追加)
- 缺点：
  - 搜索需要扫描全部记录
  - 删除会产生空洞
- 示例：搜索age>45需要读取所有9页

### 2. 排序文件(Sorted File)
- 记录按某字段排序存储
- 优点：
  - 范围查询高效
  - 可使用二分查找(时间复杂度O(log n))
- 缺点：
  - 插入/删除代价高(需维持顺序)
- 示例：二分查找age>45只需读取⌈log₂9⌉=4页

### 3. 哈希文件(Hashed File)
- 使用哈希函数将记录分布到桶中
- 优点：等值查询极快(O(1))
- 缺点：
  - 不支持范围查询
  - 哈希冲突需要处理
- 示例：哈希age字段到不同页面

### I/O成本分析
课件提供了各种操作的I/O成本对比表格(基于10GB文件，4KB页大小)：

| 操作 | 堆文件 | 排序文件 | 哈希文件 |
|------|--------|----------|----------|
| 全扫描 | 14小时 | 14小时 | 17.5小时 |
| 等值查询 | 7小时 | 0.4秒 | 20ms |
| 范围查询 | 14小时 | >0.4秒 | 17.5小时 |
| 插入 | 40ms | 14小时 | 40ms |
| 删除 | 7小时 | 14小时 | 40ms |

结论：**没有完美的文件组织方式**，各有优劣，需根据应用场景选择。

## 五、索引结构

### 索引的概念
课件通过图书馆目录的类比引入索引：
- 索引是允许快速查找具有特定搜索键值记录的数据结构
- 类似于图书馆目录通过书名快速定位书架位置
- 搜索键可以是任何字段组合(不一定是主键)

### 索引条目内容
索引存储的数据条目(k*)有两种主要形式：
1. <键值, 记录ID>对
2. <键值, 记录ID列表>

### 索引组织方式
1. **哈希索引**：
   - 使用哈希函数分布条目
   - 等值查询高效

2. **树形索引(如B+树)**：
   - 分层结构支持范围查询
   - 示例展示了按age字段组织的树形索引
   - 包含根节点、中间节点和叶节点
   - 叶节点包含实际数据条目和指向记录的指针

### 索引的优势
- 显著减少I/O开销(索引比数据小得多)
- 支持高效的点查询和范围查询
- 避免直接搜索整个数据文件

## 六、问题解答

课件包含了几个计算题及其解答，展示了如何应用上述概念：

### 问题1&2
计算不同存储策略下的磁盘访问时间，关键点：
1. 计算每条磁道的容量(扇区数×扇区大小)
2. 确定需要的磁道/柱面数
3. 计算总时间(首次访问+后续访问)

### 问题3
关于I/O成本计算：
1. 计算单个记录大小(128字节)
2. 确定总页数(100页)
3. 全扫描成本=100 I/O
4. 平均点查询成本=(1+100)/2=50.5 I/O

## 七、总结

这份课件系统性地介绍了数据库存储和访问的核心概念：
1. 理解存储层次结构和磁盘特性对数据库设计至关重要
2. 数据布局策略显著影响I/O性能
3. 不同的文件组织各有优劣，需根据应用需求选择
4. 索引是提高查询效率的关键技术
5. I/O成本是评估访问方法的主要指标

这些知识为理解数据库内部工作原理和性能优化奠定了基础。
