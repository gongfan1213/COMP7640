# COMP7640 数据库系统与管理 第二次书面作业详解

## 问题1：磁盘访问时间计算

### 题目描述
给定一个磁盘有以下特性：
- 平均寻道时间：20 ms
- 磁道间寻道时间：4 ms
- 旋转延迟：4 ms
- 最大传输速率：20 ms/磁道
- 每扇区字节数：256
- 每磁道扇区数：50
- 每柱面磁道数：10
- 每表面磁道数：1,000

假设有一个包含500条256字节记录的文件。

#### (1) 采用"随机"策略将所有记录从磁盘传输到主内存需要多少秒？(10分)

**解答**：
每条记录的访问时间 = 寻道时间 + 旋转延迟 + 传输时间  
= 20ms(平均寻道) + 4ms(旋转延迟) + (20ms/50)(每扇区传输时间)  
= 24.4 ms

总时间 = 500条记录 × 24.4ms/记录 = 12,200ms = 12.2秒

#### (2) 采用"相邻"策略将所有记录从磁盘传输到主内存需要多少秒？(20分)

**解答**：
方法1：
- 每磁道容量 = 256字节/扇区 × 50扇区 = 12,800字节
- 500条记录总大小 = 500 × 256 = 128,000字节
- 需要磁道数 = 128,000/12,800 = 10磁道 = 1柱面(因为每柱面10磁道)
- 访问时间 = 首次访问(20+4+10×20) = 224ms

方法2：
- 每条记录正好占1个扇区(256字节)
- 第一条记录：20+4+0.4 = 24.4ms
- 剩余499条记录：0.4ms × 499 = 199.6ms
- 总时间 = 24.4 + 199.6 = 224ms

## 问题2：ISAM索引与二分查找I/O成本比较

### 题目描述
给定一个关系R包含1,000,000条记录，每条记录64字节。每个磁盘块(页)可容纳4,000字节数据。在R上建立一个ISAM索引，其中索引的叶/非叶页中每个条目占4字节。

**解答**：

#### 1. 计算数据页数量
- 每条记录64字节
- 每页4,000字节
- 每页可存储记录数 = floor(4,000/64) = 62条
- 总数据页数 = ceil(1,000,000/62) ≈ 16,130页

#### 2. ISAM索引结构
- 每个索引条目4字节
- 每页可存储条目数 = 4,000/4 = 1,000条
- 扇出(Fan-out) F = 1,001
- 叶页数量 = ceil(1,000,000/1,001) ≈ 1,000页

#### 3. I/O成本比较
- **ISAM索引搜索**：2次I/O (1次根页 + 1次叶页)
- **二分查找**：ceil(log₂16,130) ≈ 14次I/O

## 问题3：B+树操作

### 题目描述
给定一个B+树索引(如图1所示)，所有键值都是整数，叶页中的数据条目是<键,记录ID>对。

#### (1) 查询12<key<23需要多少次I/O(包括读取记录)？(10分)

**解答**：
- 访问B+树索引：5次I/O (从根到叶的路径)
- 读取满足条件的记录：4条记录(假设每条记录在单独页)
- 总I/O：5(索引) + 4(数据) = 9次

#### (2) 在原B+树中插入4*和6*后绘制B+树(10分)

**解答**：
插入操作后B+树结构变化(具体结构取决于原树，但通常需要保持平衡)

#### (3) 从原B+树中删除37*后绘制B+树(15分)

**解答**：
删除操作后B+树结构变化(可能需要合并节点以保持平衡)

## 关键概念总结

1. **磁盘访问时间组成**：
   - 寻道时间(Seek Time)：磁头移动到目标磁道
   - 旋转延迟(Rotational Delay)：等待目标扇区旋转到磁头下
   - 传输时间(Transfer Time)：实际数据传输

2. **数据布局策略**：
   - 随机访问：每条记录独立定位，开销大
   - 顺序访问：利用局部性原理，显著减少开销

3. **索引结构比较**：
   - ISAM：静态索引结构，适合很少更新的数据
   - B+树：动态平衡树，适合频繁更新的数据
   - 索引搜索通常比二分查找更高效

4. **I/O成本计算**：
   - 主要考虑磁盘页访问次数
   - 索引深度和扇出是关键因素

这份作业考察了数据库系统中存储结构和访问方法的核心概念，包括磁盘特性、索引结构和查询处理成本分析。理解这些概念对于设计高效数据库系统至关重要。
